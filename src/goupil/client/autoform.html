<!DOCTYPE html>
<!--
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.
-->
<html>
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"/>

        <title>goupil autoform</title>

        <script src="{BASE_URL}static/ace.js"></script>
        <script src="{BASE_URL}static/goupil.pk.js"></script>
        <script>
            function refreshAndSave() {
                let editor = ace.edit('af_editor');
                let page = document.querySelector('#af_page');

                let script = editor.getValue();

                let autoform = new AutoForm(page);
                if (autoform.render(script))
                    sessionStorage.setItem('goupil_autoform_script', script);
            }

            document.addEventListener('readystatechange', function() {
                if (document.readyState === 'complete') {
                    let editor = ace.edit('af_editor');

                    editor.setTheme('ace/theme/monokai');
                    editor.setShowPrintMargin(false);
                    editor.setFontSize(12);
                    editor.session.setMode('ace/mode/javascript');

                    let script = sessionStorage.getItem('goupil_autoform_script');
                    if (script == null) {
                        script = `// Test autoform script

page.integer("age", "Quel est votre âge ?", {min: 18, max: 120});

let sexe = page.dropdown("sexe", "Quel est votre sexe ?",
                         [["M", "Homme"], ["F", "Femme"]]);

if (sexe.value == "F")
    page.boolean("enceinte", "Êtes-vous enceinte ?");

page.section("Alcool", () => {
    let alcool = page.boolean("alcool", "Consommez-vous de l'alcool ?");
    if (alcool.value && page.value("enceinte")) {
        alcool.error("Pensez au bébé...");
        alcool.error("On peut mettre plusieurs erreurs");
        page.error("alcool", "Et de plein de manières différentes !");
    }
    if (alcool.value)
        page.integer("alcool_qt", "Combien de verres par semaine ?", {min: 1, max: 30});
});

page.section("Autres", () => {
    page.integer("enfants", "Combien avez-vous d'enfants ?", {min: 0, max: 30});
    page.boolean("frites", "Aimez-vous les frites ?",
                 {help: "Si si, c'est important, je vous le jure !"});
});

page.output(html\`On peut aussi mettre du <b>HTML directement</b> si on veut...\`);
page.output("Ou bien encore mettre du <b>texte brut</b>.");
`;
                    }
                    editor.setValue(script);
                    editor.clearSelection();

                    editor.on('change', e => {
                        // If something goes wrong during refreshAndSave(), we don't
                        // want to break ACE state.
                        setTimeout(refreshAndSave, 0);
                    });
                    refreshAndSave();
                }
            });
        </script>

        <link rel="stylesheet" href="{BASE_URL}static/goupil.pk.css"/>
    </head>

    <body>
        <nav id="gp_menu">
            <a class="active" href="{BASE_URL}autoform">Formulaire</a>
            <a href="{BASE_URL}schedule">Agenda</a>
        </nav>

        <main>
            <div id="af_editor"></div>
            <div id="af_page"></div>
        </main>
    </body>
</html>
