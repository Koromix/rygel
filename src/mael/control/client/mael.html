<!DOCTYPE html>
<!-- This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU Affero General Public License as published by
     the Free Software Foundation, either version 3 of the License, or
     (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU Affero General Public License for more details.

     You should have received a copy of the GNU Affero General Public License
     along with this program. If not, see https://www.gnu.org/licenses/. -->
<html>
    <head>
        <meta charset="utf-8"/>

        <link rel="icon" href="favicon.png"/>
        <link rel="manifest" href="manifest.json"/>
        <title>Maël</title>

        <script>
            // Mael
            // https://koromix.dev/mael

            // Version: {VERSION}
            // Compiler: {COMPILER}

            var ENV = {
                pwa: {PWA}
            };
        </script>
        <script src="static/mael.pk.js" async></script>

        <link rel="stylesheet" href="static/OpenSans.css" async/>
        <style>
            html {
                height: 100%;
            }

            body {
                display: flex;
                height: 100%;
                margin: 0;
                padding: 0;
                background-color: #242525;
                color: white;
                font-family: 'Open Sans', sans-serif;
                font-size: 18px;
                align-items: center;
                justify-content: center;
            }

            .loading {
                display: flex;
                height: 100%;
                align-items: center;
                justify-content: center;
            }
            .loading::after {
                content: ' ';
                display: block;
                width: 48px;
                height: 48px;
                margin: 1px;
                border-radius: 50%;
                border: 12px solid white;
                border-color: white transparent white transparent;
                animation: spinner 0.8s ease-in-out infinite;
            }
            .loading > * { display: none !important; }
            @keyframes spinner {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            #fatal {
                padding: 1em;
            }

            #game {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <noscript>Cette application nécessite un support Javascript</noscript>

        <canvas id="game"></canvas>
        <script>
            try {
                // Test let and async support
                eval('let test = async function() {}');

                document.body.classList.add('loading');
                window.addEventListener('load', function(e) {
                    if (typeof checkBrowser !== 'undefined') {
                        var p = checkBrowser();

                        p.then(function() {
                            var p = start();

                            p.then(function() {
                                document.body.classList.remove('loading');
                            });
                            p.catch(function(err) {
                                document.body.innerHTML =
                                    '<div id="fatal">' +
                                        '<p><b>Une erreur est survenue pendant le chargement</b>' +
                                        '<p style="color: #777; font-size: 0.9em;">' + err.message +
                                    '</div>';
                                document.body.classList.remove('loading');
                            });
                        });
                        p.catch(updateBrowser);
                    } else {
                        document.body.innerHTML =
                            '<div id="fatal">' +
                                '<b>Échec de chargement du code javascript</b>' +
                            '</div>';
                        document.body.classList.remove('loading');
                    }
                });
            } catch (err) {
                updateBrowser(err);
            }

            function updateBrowser(err) {
                document.body.classList.remove('loading');
                document.body.innerHTML =
                    '<div id="fatal">' +
                        '<p><b>Ce navigateur n\'est pas supporté, ou il s\'agit d\'une version trop ancienne</b>' +
                        '<p>Vous pouvez utiliser Chrome (version ≥ 55), Firefox (version ≥ 65), Edge (version ≥ 18), Safari (≥ 14)\n' +
                        '<p style="color: #888; font-size: 0.9em;">Erreur : ' + err.message
                    '</div>';
            }
        </script>
    </body>
</html>
