<!DOCTYPE html>
<!--
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.
-->
<html>
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"/>

        <link rel="icon" href="{BASE_URL}favicon.png" />
        <title>{APP_NAME}</title>

        <script>
            // Version: {VERSION}

            var env = {
                app_key: '{APP_KEY}',
                app_name: '{APP_NAME}',
                base_url: '{BASE_URL}',

                use_offline: {USE_OFFLINE},
                sync_mode: '{SYNC_MODE}',

                cache_key: '{CACHE_KEY}'
            };
        </script>
        <script src="{BASE_URL}static/goupile.pk.js"></script>

        <link rel="stylesheet" href="{BASE_URL}static/goupile.pk.css"/>
        {LINK_MANIFEST}
    </head>

    <body>
        <div id="gp_root"></div>
        <script>
            try {
                eval('async function test() {}');

                // See here: https://github.com/dfahlander/Dexie.js/issues/317
                let m = navigator.userAgent.match('Firefox/([0-9]+)');
                if (m != null) {
                    let version = parseInt(m[1], 10);
                    if (version < 60)
                        throw new Error('Cannot work with broken async in IndexedDB');
                }

                document.querySelector('#gp_root').classList.add('busy');
                document.addEventListener('readystatechange', function(e) {
                    if (document.readyState === 'complete')
                        goupile.startApp();
                });
            } catch (err) {
                let el = document.querySelector('#gp_root');
                el.innerHTML =
                    '<div class="gp_wip">' +
                    '    <b>Ce navigateur n\'est pas supporté, ou il s\'agit d\'une version trop ancienne</b><br/>' +
                    '    Vous pouvez utiliser Chrome (version ≥ 55), Firefox (version ≥ 60), Edge (version ≥ 17), Safari (≥ 11)' +
                    '</div>';
            }
        </script>
        <noscript><div class="gp_wip">Cette application nécessite un support Javascript</div></noscript>
    </body>
</html>
