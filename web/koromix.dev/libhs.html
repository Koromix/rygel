<!DOCTYPE html>
<!-- This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU Affero General Public License as published by
     the Free Software Foundation, either version 3 of the License, or
     (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU Affero General Public License for more details.

     You should have received a copy of the GNU Affero General Public License
     along with this program. If not, see https://www.gnu.org/licenses/. -->
<html class="nojs" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>koromix.dev — libhs</title>

        <link rel="stylesheet" href="static/koromix.dev.css">
        <link rel="stylesheet" href="static/opensans/OpenSans.css"/>

        <script type="text/javascript" src="static/koromix.dev.js" async></script>
    </head>

    <body class="js">
        <div id="top">
            <a id="top_deploy" onclick="parentNode.querySelector('#top_menu').classList.toggle('active');"></a>
            <nav id="top_menu">
                <ul>
                    <li><a href="/index">Home</a></li>
                    <li><a href="/goupile">Goupile</a></li>
                    <li><a href="/tytools">TyTools</a></li>
                    <li><a href="/libhs" class="active">libhs</a></li>
                    <li><a href="/misc">Other</a></li>

                    <li style="float: right;"><a href="mailto:niels.martignene@protonmail.com">Contact</a></li>
                    <li style="float: right;"><a href="https://github.com/Koromix">GitHub Profile</a></li>
                </ul>
            </nav>
        </div>

        <div id="content">
            <a id="side_deploy" onclick="parentNode.querySelector('#side_menu').classList.toggle('active');"></a>
            <nav id="side_menu">
                <ul>
                    <li><a href="#overview" class="lv1">Overview</a></li>
                    <li><a href="#build" class="lv1">Build</a></li>
                    <li><a href="#license" class="lv1">License</a></li>
                    <li><a href="#contribute" class="lv1">Contribute</a></li>
                    <li><a href="#examples" class="lv1">Examples</a></li>
                </ul>
            </nav>

            <main>
                <h1 id="overview">Overview</h1>
                <p>libhs is a C library to enumerate HID and serial devices and interact with them.</p>
                <ul>
                    <li><b>single-file</b>: one header is all you need to make it work.</li>
                    <li><b>public domain</b>: use it, hack it, do whatever you want.</li>
                    <li><b>multiple platforms</b>: Windows (≥ Vista), Mac OS X (≥ 10.9) and Linux.</li>
                    <li><b>multiple compilers</b>: MSVC (≥ 2015), GCC and Clang.</li>
                    <li><b>driverless</b>: uses native OS-provided interfaces and does not require custom drivers.</li>
                </ul>

                <h1 id="build">Build</h1>
                <p>Just <a href="https://github.com/Koromix/libraries">download libhs.h from the GitHub repository</a>.
                This file provides both the interface and the implementation. To instantiate the implementation,
                <code>#define HS_IMPLEMENTATION</code> in <em>ONE</em> source file, before including libhs.h.</p>

                <p>libhs depends on <b>a few OS-provided libraries</b> that you need to link:</p>

                <table>
                    <thead>
                        <tr>
                            <th>OS</th>
                            <th>Dependencies</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Windows (MSVC)</td>
                            <td>Nothing to do, libhs uses <code>#pragma comment(lib)</code></td>
                        </tr>
                        <tr>
                            <td>Windows (MinGW-w64)</td>
                            <td>Link <em>user32, advapi32, setupapi and hid</em> <code>-luser32 -ladvapi32 -lsetupapi -lhid</code></td>
                        </tr>
                        <tr>
                            <td>OSX (Clang)</td>
                            <td>Link <em>CoreFoundation and IOKit</em> <code>-framework CoreFoundation -framework IOKit</code></td>
                        </tr>
                        <tr>
                            <td>Linux (GCC)</td>
                            <td>Link <em>libudev</em> <code>-ludev</code></td>
                        </tr>
                    </tbody>
                </table>

                <p>This library is developed as part of the TyTools project where you can find the original
                <a href="https://github.com/Koromix/tytools/tree/master/src/libhs">libhs source code</a>. The
                amalgamated header file is automatically produced by CMake scripts.</p>
                <p>Look at <a href="https://github.com/nothings/stb">Sean Barrett's excellent stb libraries</a> for the
                reasoning behind this mode of distribution.</p>

                <h1 id="license">License</h1>
                <p>libhs is in the <b>public domain</b>, or the equivalent where that is not possible. You can and should
                do anything you want with it. You have no legal obligation to do anything else, although I
                appreciate attribution.</p>

                <h1 id="contribute">Contribute</h1>
                <p>You can clone the code and report bugs on the <a href="https://github.com/Koromix/tytools">TyTools GitHub
                repository</a>.</p>

                <h1 id="examples">Examples and documentation</h1>
                <p>You can find a few complete <a href="https://github.com/Koromix/tytools/tree/master/src/libhs/examples">working
                examples in the GitHub repository</a>.</p>

                <p>The following code uses libhs to enumerate serial and HID devices:</p>

<!-- HTML generated using hilite.me (style: manni) -->
<pre>
<span class="line"></span><span style="color: #0099FF; font-style: italic">/* libhs - public domain</span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">   Niels Martignène &lt;niels.martignene@protonmail.com&gt;</span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">   https://koromix.dev/libhs</span>
<span class="line"></span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">   This software is in the public domain. Where that dedication is not</span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">   recognized, you are granted a perpetual, irrevocable license to copy,</span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">   distribute, and modify this file as you see fit.</span>
<span class="line"></span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">   See the LICENSE file for more details. */</span>
<span class="line"></span>
<span class="line"></span><span style="color: #009999">#include &lt;inttypes.h&gt;</span>
<span class="line"></span><span style="color: #009999">#include &lt;stdio.h&gt;</span>
<span class="line"></span>
<span class="line"></span><span style="color: #009999">#define HS_IMPLEMENTATION</span>
<span class="line"></span><span style="color: #009999">#include &quot;libhs.h&quot;</span>
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">static</span> <span style="color: #007788; font-weight: bold">int</span> <span style="color: #CC00FF">device_callback</span>(hs_device <span style="color: #555555">*</span>dev, <span style="color: #007788; font-weight: bold">void</span> <span style="color: #555555">*</span>udata)
<span class="line"></span>{
<span class="line"></span>    (<span style="color: #007788; font-weight: bold">void</span>)(udata);
<span class="line"></span>
<span class="line"></span>    printf(<span style="color: #CC3300">&quot;+ %s@%&quot;</span>PRIu8<span style="color: #CC3300">&quot; %04&quot;</span>PRIx16<span style="color: #CC3300">&quot;:%04&quot;</span>PRIx16<span style="color: #CC3300">&quot; (%s)</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&quot;</span>,
<span class="line"></span>           dev<span style="color: #555555">-&gt;</span>location, dev<span style="color: #555555">-&gt;</span>iface_number, dev<span style="color: #555555">-&gt;</span>vid, dev<span style="color: #555555">-&gt;</span>pid,
<span class="line"></span>           hs_device_type_strings[dev<span style="color: #555555">-&gt;</span>type]);
<span class="line"></span>    printf(<span style="color: #CC3300">&quot;  - device node:   %s</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&quot;</span>, dev<span style="color: #555555">-&gt;</span>path);
<span class="line"></span>    <span style="color: #006699; font-weight: bold">if</span> (dev<span style="color: #555555">-&gt;</span>manufacturer_string)
<span class="line"></span>        printf(<span style="color: #CC3300">&quot;  - manufacturer:  %s</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&quot;</span>, dev<span style="color: #555555">-&gt;</span>manufacturer_string);
<span class="line"></span>    <span style="color: #006699; font-weight: bold">if</span> (dev<span style="color: #555555">-&gt;</span>product_string)
<span class="line"></span>        printf(<span style="color: #CC3300">&quot;  - product:       %s</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&quot;</span>, dev<span style="color: #555555">-&gt;</span>product_string);
<span class="line"></span>    <span style="color: #006699; font-weight: bold">if</span> (dev<span style="color: #555555">-&gt;</span>serial_number_string)
<span class="line"></span>        printf(<span style="color: #CC3300">&quot;  - serial number: %s</span><span style="color: #CC3300; font-weight: bold">\n</span><span style="color: #CC3300">&quot;</span>, dev<span style="color: #555555">-&gt;</span>serial_number_string);
<span class="line"></span>
<span class="line"></span>    <span style="color: #0099FF; font-style: italic">/* If you return a non-zero value, the enumeration is aborted and this value is returned</span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">       from the calling function. */</span>
<span class="line"></span>    <span style="color: #006699; font-weight: bold">return</span> <span style="color: #FF6600">0</span>;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span style="color: #007788; font-weight: bold">int</span> <span style="color: #CC00FF">main</span>(<span style="color: #007788; font-weight: bold">void</span>)
<span class="line"></span>{
<span class="line"></span>    <span style="color: #007788; font-weight: bold">int</span> r;
<span class="line"></span>
<span class="line"></span>    <span style="color: #0099FF; font-style: italic">/* Go through the device tree and call our callback for each device. The callback can abort</span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">       the enumeration by returning a non-zero value. */</span>
<span class="line"></span>    r <span style="color: #555555">=</span> hs_enumerate(<span style="color: #336666">NULL</span>, <span style="color: #FF6600">0</span>, device_callback, <span style="color: #336666">NULL</span>);
<span class="line"></span>    <span style="color: #006699; font-weight: bold">if</span> (r <span style="color: #555555">&lt;</span> <span style="color: #FF6600">0</span>)
<span class="line"></span>        <span style="color: #006699; font-weight: bold">return</span> <span style="color: #555555">-</span>r;
<span class="line"></span>
<span class="line"></span>    <span style="color: #006699; font-weight: bold">return</span> <span style="color: #FF6600">0</span>;
<span class="line"></span>}
</pre>

                <p>The reference documentation is in the header file, but if you prefer
                you can <a href="https://koromix.dev/doxygen/libhs/">consult it on the web</a> (generated by Doxygen).</p>
            </main>
        </div>

        <footer>Niels Martignène&nbsp;&nbsp;&nbsp;<span style="opacity: 0.6;">Koromix</span></footer>
    </body>
</html>
