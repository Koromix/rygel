<!DOCTYPE html>
<!-- This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU Affero General Public License as published by
     the Free Software Foundation, either version 3 of the License, or
     (at your option) any later version.

     This program is distributed in the hope that it will be useful,
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU Affero General Public License for more details.

     You should have received a copy of the GNU Affero General Public License
     along with this program. If not, see https://www.gnu.org/licenses/. -->
<html class="nojs" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>koromix.dev â€” Koffi</title>

        <link rel="stylesheet" href="static/koromix.dev.css">
        <link rel="stylesheet" href="static/opensans/OpenSans.css"/>

        <script type="text/javascript" src="static/koromix.dev.js" async></script>
    </head>

    <body class="js">
        <div id="top">
            <a id="top_deploy" onclick="parentNode.querySelector('#top_menu').classList.toggle('active');"></a>
            <nav id="top_menu">
                <ul>
                    <li><a href="/index">Home</a></li>
                    <li><a href="/goupile">Goupile</a></li>
                    <li><a href="/tytools">TyTools</a></li>
                    <li><a href="/libhs">libhs</a></li>
                    <li><a href="/koffi" class="active">Koffi</a></li>
                    <li><a href="/misc">Other</a></li>

                    <li style="float: right;"><a href="mailto:niels.martignene@protonmail.com">Contact</a></li>
                    <li style="float: right;"><a href="https://github.com/Koromix">GitHub Profile</a></li>
                </ul>
            </nav>
        </div>

        <div id="content">
            <a id="side_deploy" onclick="parentNode.querySelector('#side_menu').classList.toggle('active');"></a>
            <nav id="side_menu">
                <ul>
                    <li><a href="#overview" class="lv1">Overview</a></li>
                    <li><a href="#example" class="lv1">Example</a></li>
                </ul>
            </nav>

            <main>
                <h1 id="overview">Overview</h1>
                <p>Koffi is a fast and easy-to-use FFI module for <a href="https://nodejs.org/">Node.js</a>, with support for complex data types such as structs.</p>
                <p>The following platforms <b>are officially supported and tested</b> at the moment:</p>
                <ul>
                    <li>Windows x86 <i>(cdecl, stdcall)</i></li>
                    <li>Windows x86_64</li>
                    <li>Linux x86</li>
                    <li>Linux x86_64</li>
                    <li>Linux ARM32+VFP Little Endian</li>
                    <li>Linux ARM64 Little Endian</li>
                    <li>FreeBSD x86</li>
                    <li>FreeBSD x86_64</li>
                    <li>FreeBSD ARM64 Little Endian</li>
                    <li>macOS x86_64</li>
                    <li>macOS ARM64 (M1) Little Endian</li>
                </ul>
                <p>The following platforms <b>may be supported</b> but are not tested:</p>
                <ul>
                    <li>NetBSD x86</li>
                    <li>NetBSD x86_64</li>
                    <li>NetBSD ARM64</li>
                    <li>OpenBSD x86</li>
                    <li>OpenBSD x86_64</li>
                    <li>OpenBSD ARM64</li>
                </ul>
                <p>This is still in development, bugs are to expected. More tests will come in the near future.</p>
                <p>You can find more information about Koffi (installation, tests, etc.) <a href="https://github.com/Koromix/luigi/tree/master/koffi">in the official repository</a>.</p>
                <h1 id="example">Example</h1>
                <p>This example illustrates how to use Koffi with a Raylib shared library:</p>
                <!-- HTML generated using hilite.me (manni) -->
<pre>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> koffi <span style="color: #555555">=</span> require(<span style="color: #CC3300">'koffi'</span>);
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> Color <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'Color'</span>, {
<span class="line"></span>    r<span style="color: #555555">:</span> <span style="color: #CC3300">'uchar'</span>,
<span class="line"></span>    g<span style="color: #555555">:</span> <span style="color: #CC3300">'uchar'</span>,
<span class="line"></span>    b<span style="color: #555555">:</span> <span style="color: #CC3300">'uchar'</span>,
<span class="line"></span>    a<span style="color: #555555">:</span> <span style="color: #CC3300">'uchar'</span>
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> Image <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'Image'</span>, {
<span class="line"></span>    data<span style="color: #555555">:</span> koffi.pointer(<span style="color: #CC3300">'void'</span>),
<span class="line"></span>    width<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    height<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    mipmaps<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    format<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> GlyphInfo <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'GlyphInfo'</span>, {
<span class="line"></span>    value<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    offsetX<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    offsetY<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    advanceX<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    image<span style="color: #555555">:</span> Image
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> Vector2 <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'Vector2'</span>, {
<span class="line"></span>    x<span style="color: #555555">:</span> <span style="color: #CC3300">'float'</span>,
<span class="line"></span>    y<span style="color: #555555">:</span> <span style="color: #CC3300">'float'</span>
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> Rectangle <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'Rectangle'</span>, {
<span class="line"></span>    x<span style="color: #555555">:</span> <span style="color: #CC3300">'float'</span>,
<span class="line"></span>    y<span style="color: #555555">:</span> <span style="color: #CC3300">'float'</span>,
<span class="line"></span>    width<span style="color: #555555">:</span> <span style="color: #CC3300">'float'</span>,
<span class="line"></span>    height<span style="color: #555555">:</span> <span style="color: #CC3300">'float'</span>
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> Texture <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'Texture'</span>, {
<span class="line"></span>    id<span style="color: #555555">:</span> <span style="color: #CC3300">'uint'</span>,
<span class="line"></span>    width<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    height<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    mipmaps<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    format<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> Font <span style="color: #555555">=</span> koffi.struct(<span style="color: #CC3300">'Font'</span>, {
<span class="line"></span>    baseSize<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    glyphCount<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    glyphPadding<span style="color: #555555">:</span> <span style="color: #CC3300">'int'</span>,
<span class="line"></span>    texture<span style="color: #555555">:</span> Texture,
<span class="line"></span>    recs<span style="color: #555555">:</span> koffi.pointer(Rectangle),
<span class="line"></span>    glyphs<span style="color: #555555">:</span> koffi.pointer(GlyphInfo)
<span class="line"></span>});
<span class="line"></span>
<span class="line"></span><span style="color: #0099FF; font-style: italic">// Fix the path to Raylib DLL if needed</span>
<span class="line"></span><span style="color: #006699; font-weight: bold">let</span> lib <span style="color: #555555">=</span> koffi.load(<span style="color: #CC3300">'build/raylib'</span> <span style="color: #555555">+</span> koffi.extension);
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> InitWindow <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'InitWindow'</span>, <span style="color: #CC3300">'void'</span>, [<span style="color: #CC3300">'int'</span>, <span style="color: #CC3300">'int'</span>, <span style="color: #CC3300">'string'</span>]);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> SetTargetFPS <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'SetTargetFPS'</span>, <span style="color: #CC3300">'void'</span>, [<span style="color: #CC3300">'int'</span>]);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> GetScreenWidth <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'GetScreenWidth'</span>, <span style="color: #CC3300">'int'</span>, []);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> GetScreenHeight <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'GetScreenHeight'</span>, <span style="color: #CC3300">'int'</span>, []);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> ClearBackground <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'ClearBackground'</span>, <span style="color: #CC3300">'void'</span>, [Color]);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> BeginDrawing <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'BeginDrawing'</span>, <span style="color: #CC3300">'void'</span>, []);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> EndDrawing <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'EndDrawing'</span>, <span style="color: #CC3300">'void'</span>, []);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> WindowShouldClose <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'WindowShouldClose'</span>, <span style="color: #CC3300">'bool'</span>, []);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> GetFontDefault <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'GetFontDefault'</span>, Font, []);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> MeasureTextEx <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'MeasureTextEx'</span>, Vector2, [Font, <span style="color: #CC3300">'string'</span>, <span style="color: #CC3300">'float'</span>, <span style="color: #CC3300">'float'</span>]);
<span class="line"></span><span style="color: #006699; font-weight: bold">const</span> DrawTextEx <span style="color: #555555">=</span> lib.cdecl(<span style="color: #CC3300">'DrawTextEx'</span>, <span style="color: #CC3300">'void'</span>, [Font, <span style="color: #CC3300">'string'</span>, Vector2, <span style="color: #CC3300">'float'</span>, <span style="color: #CC3300">'float'</span>, Color]);
<span class="line"></span>
<span class="line"></InitWindow(<span style="color: #FF6600">800</span>, <span style="color: #FF6600">600</span>, <span style="color: #CC3300">'Test Raylib'</span>);
<span class="line"></SetTargetFPS(<span style="color: #FF6600">60</span>);
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">let</span> angle <span style="color: #555555">=</span> <span style="color: #FF6600">0</span>;
<span class="line"></span>
<span class="line"></span><span style="color: #006699; font-weight: bold">while</span> (<span style="color: #555555">!</span>WindowShouldClose()) {
<span class="line"></span>    BeginDrawing();
<span class="line"></span>    ClearBackground({ r<span style="color: #555555">:</span> <span style="color: #FF6600">0</span>, g<span style="color: #555555">:</span> <span style="color: #FF6600">0</span>, b<span style="color: #555555">:</span> <span style="color: #FF6600">0</span>, a<span style="color: #555555">:</span> <span style="color: #FF6600">255</span> }); <span style="color: #0099FF; font-style: italic">// black</span>
<span class="line"></span>
<span class="line"></span>    <span style="color: #006699; font-weight: bold">let</span> win_width <span style="color: #555555">=</span> GetScreenWidth();
<span class="line"></span>    <span style="color: #006699; font-weight: bold">let</span> win_height <span style="color: #555555">=</span> GetScreenHeight();
<span class="line"></span>
<span class="line"></span>    <span style="color: #006699; font-weight: bold">let</span> text <span style="color: #555555">=</span> <span style="color: #CC3300">'Hello World!'</span>;
<span class="line"></span>    <span style="color: #006699; font-weight: bold">let</span> text_width <span style="color: #555555">=</span> MeasureTextEx(GetFontDefault(), text, <span style="color: #FF6600">32</span>, <span style="color: #FF6600">1</span>).x;
<span class="line"></span>
<span class="line"></span>    <span style="color: #006699; font-weight: bold">let</span> color <span style="color: #555555">=</span> {
<span class="line"></span>        r<span style="color: #555555">:</span> <span style="color: #FF6600">127.5</span> <span style="color: #555555">+</span> <span style="color: #FF6600">127.5</span> <span style="color: #555555">*</span> <span style="color: #336666">Math</span>.sin(angle),
<span class="line"></span>        g<span style="color: #555555">:</span> <span style="color: #FF6600">127.5</span> <span style="color: #555555">+</span> <span style="color: #FF6600">127.5</span> <span style="color: #555555">*</span> <span style="color: #336666">Math</span>.sin(angle <span style="color: #555555">+</span> <span style="color: #336666">Math</span>.PI <span style="color: #555555">/</span> <span style="color: #FF6600">2</span>),
<span class="line"></span>        b<span style="color: #555555">:</span> <span style="color: #FF6600">127.5</span> <span style="color: #555555">+</span> <span style="color: #FF6600">127.5</span> <span style="color: #555555">*</span> <span style="color: #336666">Math</span>.sin(angle <span style="color: #555555">+</span> <span style="color: #336666">Math</span>.PI),
<span class="line"></span>        a<span style="color: #555555">:</span> <span style="color: #FF6600">255</span>
<span class="line"></span>    };
<span class="line"></span>    <span style="color: #006699; font-weight: bold">let</span> pos <span style="color: #555555">=</span> {
<span class="line"></span>        x<span style="color: #555555">:</span> (win_width <span style="color: #555555">/</span> <span style="color: #FF6600">2</span> <span style="color: #555555">-</span> text_width <span style="color: #555555">/</span> <span style="color: #FF6600">2</span>) <span style="color: #555555">+</span> <span style="color: #FF6600">120</span> <span style="color: #555555">*</span> <span style="color: #336666">Math</span>.cos(angle <span style="color: #555555">-</span> <span style="color: #336666">Math</span>.PI <span style="color: #555555">/</span> <span style="color: #FF6600">2</span>),
<span class="line"></span>        y<span style="color: #555555">:</span> (win_height <span style="color: #555555">/</span> <span style="color: #FF6600">2</span> <span style="color: #555555">-</span> <span style="color: #FF6600">16</span>) <span style="color: #555555">+</span> <span style="color: #FF6600">120</span> <span style="color: #555555">*</span> <span style="color: #336666">Math</span>.sin(angle <span style="color: #555555">-</span> <span style="color: #336666">Math</span>.PI <span style="color: #555555">/</span> <span style="color: #FF6600">2</span>)
<span class="line"></span>    };
<span class="line"></span>
<span class="line"></span>    DrawTextEx(GetFontDefault(), text, pos, <span style="color: #FF6600">32</span>, <span style="color: #FF6600">1</span>, color);
<span class="line"></span>
<span class="line"></span>    EndDrawing();
<span class="line"></span>
<span class="line"></span>    angle <span style="color: #555555">+=</span> <span style="color: #336666">Math</span>.PI <span style="color: #555555">/</span> <span style="color: #FF6600">180</span>;
<span class="line"></span>}
</pre>
            </main>
        </div>
    </body>
</html>
